<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/source/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Jimes"><meta name="keywords" content=""><meta name="description" content="复试自学记录。"><meta property="og:type" content="article"><meta property="og:title" content="数据库系统概论笔记"><meta property="og:url" content="https://jimes.cn/2025/01/11/%E6%95%B0%E6%8D%AE%E5%BA%93/index.html"><meta property="og:site_name" content="马锦的博客"><meta property="og:description" content="复试自学记录。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://jimes.cn/2025/01/11/%E6%95%B0%E6%8D%AE%E5%BA%93/%E9%99%A4%E6%B3%95.jpg"><meta property="og:image" content="https://jimes.cn/2025/01/11/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0%E8%AF%AD%E8%A8%80.png"><meta property="og:image" content="https://jimes.cn/2025/01/11/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F.jpg"><meta property="og:image" content="https://jimes.cn/2025/01/11/%E6%95%B0%E6%8D%AE%E5%BA%93/armstrong.png"><meta property="article:published_time" content="2025-01-11T01:07:40.000Z"><meta property="article:modified_time" content="2025-03-31T11:59:00.175Z"><meta property="article:author" content="Jimes"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://jimes.cn/2025/01/11/%E6%95%B0%E6%8D%AE%E5%BA%93/%E9%99%A4%E6%B3%95.jpg"><meta name="referrer" content="no-referrer-when-downgrade"><title>数据库系统概论笔记 - 马锦的博客</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"jimes.cn",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!1,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!0}},search_path:"https://cdn.jsdelivr.net/gh/jimes3/jimes3.github.io/local-search.xml",include_content_in_search:!0});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=",function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","")})</script><meta name="generator" content="Hexo 7.0.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong class="navbar-title">Jimes&#39; Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="数据库系统概论笔记"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2025-01-11 09:07" pubdate>2025年1月11日 上午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 11k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 179 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">数据库系统概论笔记</h1><p id="updated-time" class="note note-info">本文最后更新于 2025年3月31日 晚上</p><div class="markdown-body"><h1 id="第一章-绪论"><a href="#第一章-绪论" class="headerlink" title="第一章   绪论"></a>第一章 绪论</h1><h2 id="1-1-数据库系统概述"><a href="#1-1-数据库系统概述" class="headerlink" title="1.1 数据库系统概述"></a><strong>1.1 数据库系统概述</strong></h2><h3 id="1-1-1-数据库的四个基本概念"><a href="#1-1-1-数据库的四个基本概念" class="headerlink" title="1.1.1 数据库的四个基本概念"></a><strong>1.1.1 数据库的四个基本概念</strong></h3><ol><li><p><strong>数据（Data）</strong>：描述事务的符号记录</p></li><li><p><strong>数据库（DB）</strong></p><ul><li>概括地讲，数据库具有<strong>永久存储</strong>、<strong>有组织</strong>和<strong>可共享</strong>的三个基本特点。</li><li>严格地讲，数据库是<strong>长期存储在计算机内、有组织的、可共享的大量数据的集合</strong>。数据库中的数据按一定的数据模型组织、描述和存储，具有较小的冗余、较高的数据独立性和易扩展性，并可为各种用户共享。</li></ul></li><li><p><strong>数据库管理系统（DBMS）</strong>：<strong>位于用户和操作系统之间的一层数据管理软件</strong>。和操作系统一样是计算机的基础软件。</p><pre><code class="hljs">主要功能：
           1，数据定义功能
           2，数据组织、存储和管理功能
           3，数据操纵功能
           4，数据库的事务管理和运行管理功能
           5，数据库的建立和维护功能
           6，其他功能（通信功能、数据转换功能、互访和互操作功能等）
</code></pre></li><li><p><strong>数据库系统（DBS）</strong></p><ul><li>是由数据库、数据库管理系统（及其应用开发工具）、应用程序和数据库管理员（DBA）和用户组成的<strong>存储、管理、处理和维护数据的系统</strong>。</li><li>特点：<strong>数据结构化、数据共享性、数据独立性、DBMS的统一管理和控制</strong>。</li><li>数据独立性分为物理独立性和逻辑独立性。物理独立性意味着用户无需关心数据在磁盘上的存储方式，逻辑独立性指出即使数据库的逻辑结构发生变化，用户的应用程序也无需修改。</li></ul></li></ol><h3 id="1-1-2-数据库的发展阶段"><a href="#1-1-2-数据库的发展阶段" class="headerlink" title="1.1.2 数据库的发展阶段"></a><strong>1.1.2 数据库的发展阶段</strong></h3><table><thead><tr><th align="center">特点</th><th align="center">人工管理阶段</th><th align="center">文件系统阶段</th><th align="center">数据库系统阶段</th></tr></thead><tbody><tr><td align="center">数据管理者</td><td align="center">用户</td><td align="center">文件系统</td><td align="center">数据库管理系统</td></tr><tr><td align="center">数据面向的对象</td><td align="center">某一应用程序</td><td align="center">某一应用</td><td align="center">现实世界（某组织等）</td></tr><tr><td align="center">数据共享程度</td><td align="center">无共享，冗余度极大</td><td align="center">共享性差，冗余度大</td><td align="center">共享性高，冗余度小</td></tr><tr><td align="center">数据独立性</td><td align="center">不独立，完全依赖于程序</td><td align="center">独立性差</td><td align="center">具有高度的物理独立性和一定的逻辑独立性</td></tr><tr><td align="center">数据的结构化</td><td align="center">无结构</td><td align="center">记录内有结构，整体无结构</td><td align="center">整体结构化，用数据模型描述</td></tr><tr><td align="center">数据控制能力</td><td align="center">应用程序自己控制</td><td align="center">应用程序自己控制</td><td align="center">数据库管理系统控制</td></tr></tbody></table><h2 id="1-2-数据模型"><a href="#1-2-数据模型" class="headerlink" title="1.2 数据模型"></a><strong>1.2 数据模型</strong></h2><ul><li><p>对现实世界数据特征的抽象。</p><p>第一类： 概念模型（信息模型）<br>第二类： 逻辑模型，物理模型<br>现实世界 —&gt; 信息世界（概念模型）—&gt; 机器世界<br>现实世界 —-数据库设计人员—&gt; 概念模型，逻辑模型 —-数据库管理系统—-&gt; 物理模型</p></li></ul><h3 id="1-2-1-概念模型"><a href="#1-2-1-概念模型" class="headerlink" title="1.2.1 概念模型"></a><strong>1.2.1 概念模型</strong></h3><p>也称信息模型，它是按用户观点来对数据和信息建模，主要<strong>用于数据库设计</strong>。</p><ul><li>实体：客观存在并且可相互区别的事务</li><li>属性：实体所具有的某一特性</li><li>码：唯一标识实体的属性</li><li>实体型：用实体名及其属性集合来抽象和刻画同类实体</li><li>实体集：同一类型实体的集合</li><li>联系：实体之间的联系通常是指不同实体集之间的联系。实体之间的联系有一对一、一对多和多对多等联系。</li></ul><p>表示方法：<strong>E-R 图</strong>，分为实体、属性、关系三个核心部分，实体是长方形，属性是椭圆形，关系为菱形。</p><h3 id="1-2-2-逻辑模型"><a href="#1-2-2-逻辑模型" class="headerlink" title="1.2.2 逻辑模型"></a><strong>1.2.2 逻辑模型</strong></h3><p>按计算机系统的观点对数据建模，主要<strong>用于数据库管理系统的实现</strong>。</p><ul><li>层次模型</li><li>网状模型</li><li><strong>关系模型</strong></li><li>面向对象数据模型</li><li>对象关系数据模型</li><li>半结构化数据模型</li></ul><h3 id="1-2-3-物理模型"><a href="#1-2-3-物理模型" class="headerlink" title="1.2.3 物理模型"></a><strong>1.2.3 物理模型</strong></h3><p>对数据最底层的抽象，它描述数据在系统内部的表示方法和存取方法，或在磁盘&#x2F;磁带上的<strong>存储方式和存取方法</strong>，是面向计算机系统的。</p><h3 id="1-2-4-数据模型的组成要素"><a href="#1-2-4-数据模型的组成要素" class="headerlink" title="1.2.4 数据模型的组成要素"></a><strong>1.2.4 数据模型的组成要素</strong></h3><ul><li>数据结构</li><li>数据操作</li><li>数据的完整性约束：实体完整性，参照完整性，用户定义的完整性。</li></ul><h2 id="1-3-常用的数据模型"><a href="#1-3-常用的数据模型" class="headerlink" title="1.3 常用的数据模型"></a><strong>1.3 常用的数据模型</strong></h2><h3 id="1-3-1-层次模型（类似树与B树）"><a href="#1-3-1-层次模型（类似树与B树）" class="headerlink" title="1.3.1 层次模型（类似树与B树）"></a><strong>1.3.1 层次模型（类似树与B树）</strong></h3><h3 id="1-3-2-网状模型"><a href="#1-3-2-网状模型" class="headerlink" title="1.3.2 网状模型"></a><strong>1.3.2 网状模型</strong></h3><h3 id="1-3-1-关系模型（二维表）"><a href="#1-3-1-关系模型（二维表）" class="headerlink" title="1.3.1 关系模型（二维表）"></a><strong>1.3.1 关系模型（二维表）</strong></h3><ul><li>关系：一张表</li><li>关系模式：表头，表示为：关系名（属性1，属性2···）</li><li>元组：一行</li><li>属性：一列</li><li>码：唯一确定一个元组的属性组</li><li>域：属性的取值范围</li><li>分量：元组中的一个属性值（必须是不可分的数据项）</li><li>非规范关系：表中有表</li></ul><p>查询效率较低。</p><h2 id="1-4-数据库系统的结构"><a href="#1-4-数据库系统的结构" class="headerlink" title="1.4 数据库系统的结构"></a><strong>1.4 数据库系统的结构</strong></h2><h3 id="1-4-1-模式的概念"><a href="#1-4-1-模式的概念" class="headerlink" title="1.4.1 模式的概念"></a><strong>1.4.1 模式的概念</strong></h3><p>是<strong>数据库中全体数据的逻辑结构和特征的描述</strong>，它仅仅涉及型的描述，不涉及具体的值。一个具体值成为模式的一个实例。</p><ul><li>型：对某一类数据的结构和属性的说明。</li><li>值：型的一个具体赋值。</li></ul><p>模式是相对稳定的，实例是相对变动的。</p><h3 id="1-4-2-三级模式结构"><a href="#1-4-2-三级模式结构" class="headerlink" title="1.4.2 三级模式结构"></a><strong>1.4.2 三级模式结构</strong></h3><ol><li><strong>模式</strong>：也称逻辑模式&#x2F;概念模式，是<strong>数据库中全体数据的逻辑结构和特征的描述</strong>，是所有用户的公共数据视图。</li><li><strong>外模式</strong>：也称子模式或用户模式，它是数据库用户（包括应用程序员和最终用户）能够看见和使用的<strong>局部数据的逻辑结构和特征的描述</strong>，是数据库用户的数据视图，是与某一应用有关的数据的逻辑表示。</li><li><strong>内模式</strong>：也称存储模式，一个数据库只有一个内模式。它是<strong>数据物理结构和存储方式的描述</strong>，是数据在数据库内部的组织方式。</li></ol><h3 id="1-4-3-二级映像"><a href="#1-4-3-二级映像" class="headerlink" title="1.4.3 二级映像"></a><strong>1.4.3 二级映像</strong></h3><ol><li><strong>外模式&#x2F;模式映像</strong>：当模式改变时，由数据库管理员对各个外模式&#x2F;模式映像作相应改变，可以使外模式保持不变，应用程序不必修改。保证了数据与程序的<strong>逻辑独立性</strong>。</li><li><strong>模式&#x2F;内模式映像</strong>：当数据库的存储结构改变时，由数据库管理员对模式&#x2F;内模式映像作相应改变，可以使模式保持不变，从而应用程序也不用改变。保证了数据与程序的<strong>物理独立性</strong>。</li></ol><h3 id="1-4-4-联系"><a href="#1-4-4-联系" class="headerlink" title="1.4.4 联系"></a><strong>1.4.4 联系</strong></h3><ul><li>应用程序：外部视图 &lt;—&gt; 子模式</li><li>DBMS：模式 &lt;—&gt; 子模式</li><li>操作系统的存取方式：存储方式 &lt;—-&gt; 物理组织</li></ul><h2 id="1-5-数据库系统的组成"><a href="#1-5-数据库系统的组成" class="headerlink" title="1.5 数据库系统的组成"></a><strong>1.5 数据库系统的组成</strong></h2><ul><li>硬件平台及数据</li><li>软件</li><li>人员<ul><li><strong>数据库管理员</strong><ul><li>①决定数据库中的信息内容和结构</li><li>②决定数据库的存储结构和存取策略</li><li>③定义数据的安全性要求和完整性约束条件</li><li>④监控数据库的使用和运行</li><li>⑤数据库的改进和重组、重构</li></ul></li><li><strong>系统分析员</strong>：应用系统的需求分析和规范说明。</li><li><strong>数据库设计人员</strong>：数据库中数据的确定及数据库各级模式的设计。</li><li><strong>应用程序员</strong>：设计和编写应用系统的程序模块，并进行调试和安装。</li><li>用户：通过用户接口使用数据库。</li></ul></li></ul><h1 id="第二章-关系数据库"><a href="#第二章-关系数据库" class="headerlink" title="第二章 关系数据库"></a>第二章 关系数据库</h1><h2 id="2-1-关系数据结构及形式化定义"><a href="#2-1-关系数据结构及形式化定义" class="headerlink" title="2.1 关系数据结构及形式化定义"></a>2.1 关系数据结构及形式化定义</h2><h3 id="2-1-1-关系"><a href="#2-1-1-关系" class="headerlink" title="2.1.1 关系"></a>2.1.1 关系</h3><ul><li><p>目（度）：属性数</p></li><li><p>候选码：能唯一标识元组的最小属性组</p></li><li><p>超码：候选码+其它属性</p></li><li><p>主码：候选码中的一个（主关键字）</p></li><li><p>主属性：候选码的<strong>诸属性</strong>（其中之一）</p></li><li><p>非主属性（非码属性）：不包含在任何候选码中的属性</p></li><li><p>全码：所有属性都是候选码</p></li><li><p>关系的类型：基本关系（基本表），查询表，视图表</p><pre><code class="hljs">  基本关系：实际存储数据的逻辑表示。
  查询表：查询结果对应的表。
  视图表：导出表，虚表，不对应实际存储的数据。
</code></pre></li></ul><p>元组&#x3D;记录</p><h3 id="2-1-2-关系模式"><a href="#2-1-2-关系模式" class="headerlink" title="2.1.2 关系模式"></a>2.1.2 关系模式</h3><p>R（U,D,DOM,F）</p><ul><li>R 关系名</li><li>U 所有属性名</li><li>D 属性来自哪些域</li><li>DOM 属性和域的映射</li><li>F 属性间的依赖关系</li></ul><p>一般简化为R（U）</p><h2 id="2-2-关系操作（语言）"><a href="#2-2-关系操作（语言）" class="headerlink" title="2.2 关系操作（语言）"></a>2.2 关系操作（语言）</h2><p>特点：集合操作方式，即操作的对象和结果都是集合。</p><ul><li>插入</li><li>查询，基本操作：<strong>选择、投影、并、差、笛卡尔积</strong><ul><li>非基本：</li><li><strong>连接</strong>：R⋈S &#x3D; 先选择+笛卡尔积（再投影）</li><li><strong>除</strong>：<img src="/images/loading.png" srcset="/img/loading.gif" lazyload data-original="/2025/01/11/%E6%95%B0%E6%8D%AE%E5%BA%93/%E9%99%A4%E6%B3%95.jpg"><ul><li>R（X,Y），其中Y为共有属性。</li></ul></li><li><strong>交</strong>：R∩S &#x3D; R-(R-S)</li></ul></li><li>删除</li><li>修改</li></ul><h3 id="2-2-1-关系数据库基于数学上的关系代数运算和关系演算运算"><a href="#2-2-1-关系数据库基于数学上的关系代数运算和关系演算运算" class="headerlink" title="2.2.1 关系数据库基于数学上的关系代数运算和关系演算运算"></a>2.2.1 关系数据库基于数学上的关系代数运算和关系演算运算</h3><ul><li>关系数据语言：<ul><li>关系代数语言</li><li>关系演算语言</li><li>以上双重特点（SQL）</li></ul></li></ul><h3 id="2-2-2-SQL语言"><a href="#2-2-2-SQL语言" class="headerlink" title="2.2.2 SQL语言"></a>2.2.2 SQL语言</h3><h2 id="2-3-关系的完整性"><a href="#2-3-关系的完整性" class="headerlink" title="2.3 关系的完整性"></a>2.3 关系的完整性</h2><h3 id="2-3-1-实体完整性：主属性非空"><a href="#2-3-1-实体完整性：主属性非空" class="headerlink" title="2.3.1 实体完整性：主属性非空"></a>2.3.1 实体完整性：主属性非空</h3><h3 id="2-3-2-参照完整性：外码与主码之间的引用规则"><a href="#2-3-2-参照完整性：外码与主码之间的引用规则" class="headerlink" title="2.3.2 参照完整性：外码与主码之间的引用规则"></a>2.3.2 参照完整性：外码与主码之间的引用规则</h3><ul><li>外码：其它关系的主码（可以是本关系）。</li><li>外码取值为空值或主码值。</li><li>为空表示该记录与其它关系无关。</li></ul><h3 id="2-3-3-用户定义的完整性（CHECK）"><a href="#2-3-3-用户定义的完整性（CHECK）" class="headerlink" title="2.3.3 用户定义的完整性（CHECK）"></a>2.3.3 用户定义的完整性（CHECK）</h3><p>可选，实体完整性与参照完整性必须有。</p><h2 id="2-4-关系代数"><a href="#2-4-关系代数" class="headerlink" title="2.4 关系代数"></a>2.4 关系代数</h2><p><img src="/images/loading.png" srcset="/img/loading.gif" lazyload data-original="/2025/01/11/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0%E8%AF%AD%E8%A8%80.png"><br><img src="/images/loading.png" srcset="/img/loading.gif" lazyload data-original="/2025/01/11/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F.jpg"></p><h3 id="2-4-1-传统的集合运算（以元组为单位）"><a href="#2-4-1-传统的集合运算（以元组为单位）" class="headerlink" title="2.4.1 传统的集合运算（以元组为单位）"></a>2.4.1 传统的集合运算（以元组为单位）</h3><ol><li>并</li><li>差：R-S，在R中删掉S中也有的。</li><li>交</li><li>笛卡尔积</li></ol><ul><li>交并运算的两个关系都要有<strong>相同的属性</strong>。</li><li>差运算的两个关系<strong>属性个数</strong>和对应<strong>属性域</strong>必须相同。</li><li>交并差均是以元组为单位的操作。</li></ul><h3 id="2-4-2-专门的关系运算"><a href="#2-4-2-专门的关系运算" class="headerlink" title="2.4.2 专门的关系运算"></a>2.4.2 专门的关系运算</h3><ol><li><p>选择：在R中符合F条件的元组。</p></li><li><p>投影：R中的A列。（<strong>自动去重</strong>）</p></li><li><p>连接：R与S的笛卡尔积中满足条件的元组。</p><ul><li>等值连接 —&gt; 自然连接（合并同名属性） —保留悬浮元组–&gt; （左&#x2F;右）外连接</li></ul></li><li><p>除：R÷S，R、S相交属性中R对应独立属性的象集包含S的独立属性值。</p><ul><li>A属性的象集：除A属性外其它属性在特定A值下的不重复集合</li></ul></li></ol><h1 id="第三章-SQL语言"><a href="#第三章-SQL语言" class="headerlink" title="第三章 SQL语言"></a>第三章 SQL语言</h1><h2 id="3-1-SQL概述"><a href="#3-1-SQL概述" class="headerlink" title="3.1 SQL概述"></a>3.1 SQL概述</h2><ul><li>SQL 是 Structed Query Language 的缩写，意思是<strong>结构化查询语言</strong>，是关系数据库的标准语言。（通用、功能极强）</li><li>SQL对大小写不敏感。</li></ul><h2 id="3-1-1-SQL的特点"><a href="#3-1-1-SQL的特点" class="headerlink" title="3.1.1 SQL的特点"></a>3.1.1 SQL的特点</h2><ul><li>集<strong>数据定义语言（DDL）,数据操纵语言（DML），数据控制语言（DCL），数据查询语言</strong>的功能于一体。</li></ul><ol><li><strong>综合统一</strong><ul><li>可以独立完成数据库生命周期中的全部活动：<ul><li>定义和修改、删除关系模式，定义和删除试图，插入数据，建立数据库。</li><li>对数据库中的数据进行查询和更新。</li><li>数据库重构和维护。</li><li>数据库安全性、完整性控制，以及事务控制。</li><li>嵌入式SQL和动态SQL定义。</li></ul></li><li>用户在数据库投入运行后，可根据需要随时逐步修改模式，不影响数据库的运行。</li><li>数据操作府统一。</li></ul></li><li><strong>高度非过程化</strong><ul><li>用户无需了解存取路径。</li></ul></li><li><strong>面向集合的操作方式（集合 &#x3D; 表 &#x2F; 关系）</strong></li><li><strong>以同一种语法结构提供多种使用方式</strong></li><li><strong>语言简洁，易学易用</strong><table><thead><tr><th align="center">SQL功能</th><th align="center">动词</th></tr></thead><tbody><tr><td align="center">数据查询</td><td align="center">SELECT</td></tr><tr><td align="center">数据定义</td><td align="center">CREATE,DROP,ALTER</td></tr><tr><td align="center">数据操纵</td><td align="center">INSERT,UPDATE,DELETE</td></tr><tr><td align="center">数据控制</td><td align="center">GRANT,REVOKE</td></tr></tbody></table></li></ol><h2 id="3-2-数据定义"><a href="#3-2-数据定义" class="headerlink" title="3.2 数据定义"></a>3.2 数据定义</h2><table><thead><tr><th align="center">数据类型</th><th align="center">含义</th></tr></thead><tbody><tr><td align="center">CHAR(n)</td><td align="center">长度为n的定长字符串</td></tr><tr><td align="center">VARCHAR(n)</td><td align="center">最大长度为n的变长字符串</td></tr><tr><td align="center">INT</td><td align="center">长整数（4字节）</td></tr><tr><td align="center">SMALLINT</td><td align="center">短整数（2字节）</td></tr><tr><td align="center">BIGINT</td><td align="center">大整数（8字节）</td></tr><tr><td align="center">NUMERIC(p,q)</td><td align="center">定点数，p位数字，小数点后有q位</td></tr><tr><td align="center">DECIMAL(p,q)</td><td align="center">定点数，p位数字，小数点后有q位</td></tr><tr><td align="center">FLOAT(n)</td><td align="center">可选精度的浮点数，精度至少为n位数字</td></tr><tr><td align="center">BOOLEAN</td><td align="center">逻辑布尔量</td></tr><tr><td align="center">DATE</td><td align="center">年-月-日</td></tr><tr><td align="center">TIME</td><td align="center">时-分-秒</td></tr></tbody></table><table><thead><tr><th align="center">操作对象</th><th align="center">创建</th><th align="center">删除</th><th align="center">修改</th></tr></thead><tbody><tr><td align="center">模式</td><td align="center">CREATE SCHEMA</td><td align="center">DROP SCHEMA</td><td align="center">|</td></tr><tr><td align="center">表</td><td align="center">CREATE TABLE</td><td align="center">DROP TABLE</td><td align="center">ALTER TABLE</td></tr><tr><td align="center">视图</td><td align="center">CREATE VIEW</td><td align="center">DROP VIEW</td><td align="center">|</td></tr><tr><td align="center">索引</td><td align="center">CREATE INDEX</td><td align="center">DROP INDEX</td><td align="center">ALTER INDEX</td></tr></tbody></table><h3 id="3-2-1-模式的定义与删除"><a href="#3-2-1-模式的定义与删除" class="headerlink" title="3.2.1 模式的定义与删除"></a>3.2.1 模式的定义与删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 定义</span><br><span class="hljs-keyword">CREATE</span> SCHEMA <span class="hljs-operator">&lt;</span>模式名<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">AUTHORIZATION</span> <span class="hljs-operator">&lt;</span>用户名<span class="hljs-operator">&gt;</span>;<br><span class="hljs-keyword">CREATE</span> SCHEMA &quot;S-T&quot; <span class="hljs-keyword">AUTHORIZATION</span> Panzhicheng;<br><br><span class="hljs-comment">-- 删除</span><br><span class="hljs-keyword">DROP</span> SCHEMA <span class="hljs-operator">&lt;</span>模式名<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>CASCADE <span class="hljs-operator">|</span> RESTRICT<span class="hljs-operator">&gt;</span>;<br><span class="hljs-comment">-- CASCADE 级联：删除模式的同时也会把该模式的所有数据库对象删除。</span><br><span class="hljs-comment">-- RESTRICT 限制：如果该模式下有下属对象，比如表视图，就拒绝这个删除语句的执行。</span><br></code></pre></td></tr></table></figure><h3 id="3-2-2-基本表的定义、修改与删除"><a href="#3-2-2-基本表的定义、修改与删除" class="headerlink" title="3.2.2 基本表的定义、修改与删除"></a>3.2.2 基本表的定义、修改与删除</h3><p>1.定义</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> (<span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>数据类型<span class="hljs-operator">&gt;</span> [<span class="hljs-operator">&lt;</span>列级完整性约束条件<span class="hljs-operator">&gt;</span>]<br>					[,(<span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>数据类型<span class="hljs-operator">&gt;</span> [<span class="hljs-operator">&lt;</span>列级完整性约束条件<span class="hljs-operator">&gt;</span>]]···<br>                    [,表级完整性约束条件]);<br><span class="hljs-comment">-- 关键字可忽略大小写</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">User</span>(name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">primary</span> key,  <span class="hljs-comment">-- 列级完整性约束条件（name为主码）</span><br>                  age <span class="hljs-type">int</span>,<br>                  sex <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;男&#x27;</span>,  <span class="hljs-comment">-- 列级完整性约束条件（not null，默认条件）</span><br>                  <span class="hljs-keyword">FOREIGN</span> KEY (name) <span class="hljs-keyword">REFERENCES</span> Student(name)); <span class="hljs-comment">-- 表级完整性约束条件，name是外码，被参照表是Student</span><br></code></pre></td></tr></table></figure><p>2.修改</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span><br>[<span class="hljs-keyword">ADD</span> [<span class="hljs-keyword">COLUMN</span>] <span class="hljs-operator">&lt;</span>新列名<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>数据类型<span class="hljs-operator">&gt;</span> [完整性约束]] <span class="hljs-comment">-- 增加新列，列级完整性约束条件</span><br>[<span class="hljs-keyword">ADD</span> <span class="hljs-operator">&lt;</span>表级完整性约束<span class="hljs-operator">&gt;</span>] <span class="hljs-operator">/</span><span class="hljs-operator">/</span>增加表级完整性约束条件<br>[<span class="hljs-keyword">DROP</span> [<span class="hljs-keyword">COLUMN</span>] <span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span>[<span class="hljs-operator">&lt;</span>CASCADE <span class="hljs-operator">|</span> RESTRICT<span class="hljs-operator">&gt;</span>]] <span class="hljs-operator">/</span><span class="hljs-operator">/</span>删除列<br>[<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">CONSTRAINT</span> <span class="hljs-operator">&lt;</span>完整性约束名<span class="hljs-operator">&gt;</span>[<span class="hljs-operator">&lt;</span>CASCADE <span class="hljs-operator">|</span> RESTRICT<span class="hljs-operator">&gt;</span>]] <span class="hljs-comment">-- 删除指定完整性约束条件</span><br>[<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">COLUMN</span> <span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>新的数据类型<span class="hljs-operator">&gt;</span>] <span class="hljs-operator">/</span><span class="hljs-operator">/</span>修改列数据类型<br>[RENAME <span class="hljs-keyword">COLUMN</span> <span class="hljs-operator">&lt;</span>旧列名<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">TO</span> <span class="hljs-operator">&lt;</span>新列名<span class="hljs-operator">&gt;</span>]; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>修改列名<br></code></pre></td></tr></table></figure><p>3.删除</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span>[<span class="hljs-operator">&lt;</span>CASCADE <span class="hljs-operator">|</span> RESTRICT<span class="hljs-operator">&gt;</span>];<br><span class="hljs-comment">-- CASCADE 如果表有外码，视图，触发器，也会强行删除。</span><br><span class="hljs-comment">-- RESTRICT 反之。</span><br></code></pre></td></tr></table></figure><h3 id="3-2-3-索引的建立、修改与删除"><a href="#3-2-3-索引的建立、修改与删除" class="headerlink" title="3.2.3 索引的建立、修改与删除"></a>3.2.3 索引的建立、修改与删除</h3><ul><li>数据量比较大的时候，查询耗时大，建立索引可以有效减少时间消耗。</li><li>索引可以建立在一列或多列上。</li><li>用户无法显式地选择索引。<blockquote><p>索引类型：</p><ul><li>顺序文件上的索引</li><li>B+树索引</li><li>散列（hash）索引</li><li>位图索引</li></ul></blockquote></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 建立</span><br><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">UNIQUE</span>] [CLUSTER] INDEX <span class="hljs-operator">&lt;</span>索引名<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">ON</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> (<span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span>[<span class="hljs-operator">&lt;</span>次序<span class="hljs-operator">&gt;</span>][,<span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span>[<span class="hljs-operator">&lt;</span>次序<span class="hljs-operator">&gt;</span>]]···)；<span class="hljs-comment">-- 升序：ASC（默认），降序：DESC</span><br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX Stusno<br><span class="hljs-keyword">ON</span> Student(Sno);<br><br><span class="hljs-comment">-- UNIQUE 唯一索引</span><br><span class="hljs-comment">-- CLUSTER 聚簇索引：物理顺序与索引的逻辑顺序相同，比如买书。</span><br><br><br><span class="hljs-comment">-- 修改</span><br><span class="hljs-keyword">ALTER</span> INDEX <span class="hljs-operator">&lt;</span>旧索引名<span class="hljs-operator">&gt;</span> RENAME <span class="hljs-keyword">TO</span> <span class="hljs-operator">&lt;</span>新索引名<span class="hljs-operator">&gt;</span>;<br><br><span class="hljs-comment">-- 删除</span><br><span class="hljs-keyword">DROP</span> INDEX <span class="hljs-operator">&lt;</span>索引名<span class="hljs-operator">&gt;</span>;<br></code></pre></td></tr></table></figure><h3 id="3-2-4-数据字典"><a href="#3-2-4-数据字典" class="headerlink" title="3.2.4 数据字典"></a>3.2.4 数据字典</h3><ul><li>数据字典是关系数据库管理系统内部的一组系统表，它记录了数据库中<strong>所有的定义信息</strong>。</li><li>包括关系模式定义、视图定义、索引定义、完整性约束定义、各类用户对数据库的操作权限、统计信息等。</li><li>关系数据库管理系统在执行SQL 的数据定义语句时，实际上就是在更新数据字典表中的相应信息。</li></ul><h2 id="3-3-数据查询"><a href="#3-3-数据查询" class="headerlink" title="3.3 数据查询"></a>3.3 数据查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 基础架构</span><br><span class="hljs-keyword">SELECT</span> [<span class="hljs-keyword">ALL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">DISTINCT</span>] <span class="hljs-operator">&lt;</span>目标表达式<span class="hljs-operator">&gt;</span> [, <span class="hljs-operator">&lt;</span>目标表达式<span class="hljs-operator">&gt;</span>...] ... <span class="hljs-comment">-- DISTINCT：去重</span><br><span class="hljs-keyword">FROM</span> <span class="hljs-operator">&lt;</span>表名或视图名<span class="hljs-operator">&gt;</span> [, <span class="hljs-operator">&lt;</span>表名或视图名<span class="hljs-operator">&gt;</span>..]     <span class="hljs-comment">-- 或者再写个子查询</span><br>[<span class="hljs-keyword">WHERE</span> <span class="hljs-operator">&lt;</span>条件表达式<span class="hljs-operator">&gt;</span>]     <span class="hljs-comment">-- 不能用聚集函数</span><br>[<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-operator">&lt;</span>列名 <span class="hljs-number">1</span><span class="hljs-operator">&gt;</span> [<span class="hljs-keyword">HAVING</span> <span class="hljs-operator">&lt;</span>条件表达式<span class="hljs-operator">&gt;</span>]] <span class="hljs-comment">-- HAVING是分组后的筛选，WHERE是分组前</span><br>[<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-operator">&lt;</span>列名 <span class="hljs-number">2</span><span class="hljs-operator">&gt;</span> [<span class="hljs-keyword">ASC</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">DESC</span>]];<br><br><span class="hljs-comment">-- 常用模式</span><br><span class="hljs-keyword">SELECT</span> ···  <span class="hljs-keyword">FROM</span> ···  <span class="hljs-keyword">WHERE</span> ··· <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> ··· <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ··· ；<br></code></pre></td></tr></table></figure><ul><li>重点：顺序为 where –&gt; group by –&gt; having</li></ul><p>以下查询根据这三个表：</p><ul><li>学生表：student(*sno,sname,ssex,sage,sdept)</li><li>课程表：course(*cno,cname,cpno,ccredit)</li><li>学生选课表：sc(*sno,cno,grade)</li></ul><h3 id="3-3-1-单表查询"><a href="#3-3-1-单表查询" class="headerlink" title="3.3.1 单表查询"></a>3.3.1 单表查询</h3><table><thead><tr><th align="center">查询条件</th><th align="center">谓词</th></tr></thead><tbody><tr><td align="center">比较</td><td align="center">&#x3D;, &lt;, &gt; ,&lt;&#x3D;, &gt;&#x3D;, !&#x3D;, NOT+比较</td></tr><tr><td align="center">确定范围</td><td align="center">BETWEEN X AND Y,NOT BETWEEN X AND Y</td></tr><tr><td align="center">确定集合</td><td align="center">IN,NOT IN</td></tr><tr><td align="center">字符匹配</td><td align="center">LIKE,NOT LIKE</td></tr><tr><td align="center">空值</td><td align="center">ISNULL,ISNOTNULL</td></tr><tr><td align="center">逻辑运算</td><td align="center">AND,OR,NOT</td></tr></tbody></table><ul><li>between：双边闭区间</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 例子</span><br><span class="hljs-comment">-- 起别名，表达式，处理函数</span><br><span class="hljs-keyword">SELECT</span> sname <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;姓名&#x27;</span>,<span class="hljs-number">2023</span><span class="hljs-operator">-</span>sage <span class="hljs-string">&#x27;出生年月&#x27;</span>,<span class="hljs-built_in">LOWER</span>(sdept) <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-comment">-- 全选</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-comment">-- 年龄范围 BETWEEN</span><br><span class="hljs-keyword">SELECT</span> sname,<span class="hljs-number">2023</span><span class="hljs-operator">-</span>sage,sdept <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sage <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">20</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">25</span>;<br><span class="hljs-comment">-- 集合，IN</span><br><span class="hljs-keyword">SELECT</span> sname,<span class="hljs-number">2023</span><span class="hljs-operator">-</span>sage <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sdept <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;CS&#x27;</span>,<span class="hljs-string">&#x27;IS&#x27;</span>);<br><span class="hljs-comment">-- 字符匹配，模糊查询，LIKE，查找刘姓学生</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;刘%&#x27;</span>; <span class="hljs-comment">-- %：任意长度。</span><br>											  <span class="hljs-comment">-- _：单个长度任意字符</span><br><span class="hljs-comment">-- 不想使用%和_模糊查找可以使用\转义，\_  \%</span><br><br><span class="hljs-comment">-- ORDER BY</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;刘%&#x27;</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade <span class="hljs-keyword">ASC</span>; <span class="hljs-comment">-- 升序，默认升序</span><br><span class="hljs-comment">-- 先grade排，再sage排</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade <span class="hljs-keyword">ASC</span>,sage <span class="hljs-keyword">ASC</span>;<br></code></pre></td></tr></table></figure><table><thead><tr><th align="center">聚集函数</th><th align="center">含义</th></tr></thead><tbody><tr><td align="center">COUNT(*)</td><td align="center">统计元组个数</td></tr><tr><td align="center">COUNT([ALL&#x2F;DISTINCT]&lt;列名&gt;)</td><td align="center">统计列中值的个数</td></tr><tr><td align="center">SUM([ALL&#x2F;DISTINCT]&lt;列名&gt;)</td><td align="center">计算一列值的总和（必须数值型）</td></tr><tr><td align="center">AVG([ALL&#x2F;DISTINCT]&lt;列名&gt;)</td><td align="center">计算一列值的平均值（必须数值型）</td></tr><tr><td align="center">MAX([ALL&#x2F;DISTINCT]&lt;列名&gt;)</td><td align="center">求一列值中的最大值</td></tr><tr><td align="center">MIN([ALL&#x2F;DISTINCT]&lt;列名&gt;)</td><td align="center">求一列值中的最小值</td></tr></tbody></table><ul><li>聚集函数不能用在WHERE子句中</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 例子</span><br><span class="hljs-comment">-- 查询学生总人数</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-comment">-- 计算一号课程的平均成绩</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(grade) <span class="hljs-keyword">FROM</span> sc <span class="hljs-keyword">WHERE</span> cno<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br><span class="hljs-comment">-- 计算学号为202123学生的总成绩</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(grade) <span class="hljs-keyword">FROM</span> sc <span class="hljs-keyword">WHERE</span> sno<span class="hljs-operator">=</span><span class="hljs-number">202123</span>;<br><span class="hljs-comment">-- 求各个课程号的选课人数</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> sc <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> cno;<br></code></pre></td></tr></table></figure><h3 id="3-3-2-连接查询"><a href="#3-3-2-连接查询" class="headerlink" title="3.3.2 连接查询"></a>3.3.2 连接查询</h3><p>本质上就是FROM后有多个表，相当于引用了<strong>多表的笛卡尔积</strong>，其它操作与单表查询相同。</p><ul><li>等值连接</li><li>自身连接</li><li>外连接：保留不符合条件的元组</li><li>多表连接：两个以上的表进行查询</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 例子</span><br><span class="hljs-comment">-- 等值连接</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student stu,sc <span class="hljs-keyword">WHERE</span> stu.sno <span class="hljs-operator">=</span> sc.sno; <span class="hljs-comment">-- 引用的两个表是笛卡尔积形式</span><br><span class="hljs-comment">-- 自然连接(等值连接去掉重复属性列)</span><br><span class="hljs-keyword">SELECT</span> stu.cno,stu.sname,sc.cno <span class="hljs-keyword">FROM</span> student stu,sc <span class="hljs-keyword">WHERE</span> stu.sno <span class="hljs-operator">=</span> sc.sno;<br><span class="hljs-comment">-- 自身连接(给同一个表起两个别名)</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> course f,course s <span class="hljs-keyword">WHERE</span> f.cpno <span class="hljs-operator">=</span> s.cno;<br><span class="hljs-comment">-- 外连接</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> course f <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> course s <span class="hljs-keyword">on</span> f.cpno <span class="hljs-operator">=</span> s.cno; <span class="hljs-comment">-- 左外连接(保留所有f)</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> course f <span class="hljs-keyword">right</span> <span class="hljs-keyword">join</span> course s <span class="hljs-keyword">on</span> f.cpno <span class="hljs-operator">=</span> s.cno; <span class="hljs-comment">-- 右外连接(保留所有s)</span><br><br></code></pre></td></tr></table></figure><h3 id="3-3-3-嵌套查询-往往可用连接查询解决"><a href="#3-3-3-嵌套查询-往往可用连接查询解决" class="headerlink" title="3.3.3 嵌套查询(往往可用连接查询解决)"></a>3.3.3 嵌套查询(往往可用连接查询解决)</h3><p>从后往前写</p><ul><li>查询块：一个 SELECT–FROM–WHERE 语句。</li><li>嵌套查询：一个查询块在另一个查询块的 WHERE 或 HAVING 语句中。</li><li>父查询：上层查询块。</li><li>子查询：下层查询块。（不能使用 ORDER BY 语句）</li><li>不相关子查询：子查询的查询条件不依赖于父查询。</li><li>相关子查询：子查询的查询条件依赖于父查询。</li></ul><p>1.带有 IN 谓词的子查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student stu <span class="hljs-keyword">WHERE</span> sno <span class="hljs-keyword">in</span> (<span class="hljs-keyword">SELECT</span> sno <span class="hljs-keyword">FROM</span> sc <span class="hljs-keyword">WHERE</span> cno<span class="hljs-operator">=</span><span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><p>2.带有 ANY,ALL 谓词的子查询（配合比较运算符）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> sno,cno <span class="hljs-keyword">FROM</span> sc x <span class="hljs-comment">-- 使用聚集函数</span><br>	<span class="hljs-keyword">WHERE</span> grade <span class="hljs-operator">&gt;=</span> (<br>    	<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(grade) <span class="hljs-keyword">FROM</span> sc y <span class="hljs-keyword">WHERE</span> x.sno<span class="hljs-operator">=</span>y.sno<br>    );<br><br><span class="hljs-keyword">SELECT</span> sname,sage <span class="hljs-keyword">FROM</span> student  <span class="hljs-comment">-- 一个值</span><br>	<span class="hljs-keyword">WHERE</span> sage <span class="hljs-operator">&gt;=</span><span class="hljs-keyword">ANY</span>(<br>    	<span class="hljs-keyword">SELECT</span> sage <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sdept<span class="hljs-operator">=</span><span class="hljs-string">&#x27;CS&#x27;</span><br>    ) <span class="hljs-keyword">AND</span> sdept <span class="hljs-operator">!=</span> <span class="hljs-string">&#x27;CS&#x27;</span>;<br><br><span class="hljs-keyword">SELECT</span> sname,sage <span class="hljs-keyword">FROM</span> student  <span class="hljs-comment">-- 所有值</span><br>	<span class="hljs-keyword">WHERE</span> sage <span class="hljs-operator">&gt;=</span><span class="hljs-keyword">ALL</span>(<br>    	<span class="hljs-keyword">SELECT</span> sage <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sdept<span class="hljs-operator">=</span><span class="hljs-string">&#x27;CS&#x27;</span><br>    ) <span class="hljs-keyword">AND</span> sdept <span class="hljs-operator">!=</span> <span class="hljs-string">&#x27;CS&#x27;</span>;<br></code></pre></td></tr></table></figure><p>3.带有（NOT）EXISTS 谓词的子查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">	<span class="hljs-number">1.</span>存在量词，有一个或多个记录存在于。<br>	<span class="hljs-number">2.</span>带有 <span class="hljs-keyword">EXISTS</span> 谓词的子查询不返回任何数据，只产生逻辑值<span class="hljs-string">&#x27;true&#x27;</span>和<span class="hljs-string">&#x27;false&#x27;</span>。<br>		若内层查询结果为空，则外层的<span class="hljs-keyword">WHERE</span>子句返回假值<span class="hljs-string">&#x27;false&#x27;</span>;<br>        若内层查询结果非空，则外层的<span class="hljs-keyword">WHERE</span>子句返回假值<span class="hljs-string">&#x27;TRUE&#x27;</span>;<br>    <span class="hljs-number">3.</span>目标列表达式通常是<span class="hljs-operator">*</span>，因为具体列名无实际意义。<br><span class="hljs-keyword">SELECT</span> sname <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span> (<br>		<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sc <span class="hljs-keyword">WHERE</span> sno<span class="hljs-operator">=</span>student.sno <span class="hljs-keyword">AND</span> cno<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span><br>);  <span class="hljs-comment">-- 返回sname存在子查询中的记录。</span><br><br></code></pre></td></tr></table></figure><h3 id="3-3-4-集合查询"><a href="#3-3-4-集合查询" class="headerlink" title="3.3.4 集合查询"></a>3.3.4 集合查询</h3><ul><li><strong>并操作</strong>：UNION[all]</li><li><strong>交操作</strong>：INTERSECT</li><li><strong>差操作</strong>：EXCEPT</li><li>加all不去重</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-comment">-- 1. 并操作</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sdept<span class="hljs-operator">=</span><span class="hljs-string">&#x27;cs&#x27;</span><br><span class="hljs-keyword">UNION</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> ssge<span class="hljs-operator">=</span><span class="hljs-number">19</span>;<br><br><span class="hljs-comment">-- 2. 交操作</span><br><span class="hljs-keyword">SELECT</span> sno <span class="hljs-keyword">FROM</span> sc <span class="hljs-keyword">WHERE</span> cno<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span><br><span class="hljs-keyword">INTERSECT</span><br><span class="hljs-keyword">SELECT</span> sno <span class="hljs-keyword">FROM</span> sc <span class="hljs-keyword">WHERE</span> cno<span class="hljs-operator">=</span><span class="hljs-string">&#x27;2&#x27;</span>;<br><br><span class="hljs-comment">-- 3. 差操作(前-后)</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sdept<span class="hljs-operator">=</span><span class="hljs-string">&#x27;cs&#x27;</span><br><span class="hljs-keyword">EXCEPT</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> ssge <span class="hljs-operator">&lt;=</span> <span class="hljs-number">19</span>;<br></code></pre></td></tr></table></figure><h3 id="3-3-5-基于派生表的查询"><a href="#3-3-5-基于派生表的查询" class="headerlink" title="3.3.5 基于派生表的查询"></a>3.3.5 基于派生表的查询</h3><p>子查询出现在 FROM 子句中，成为临时<strong>派生表</strong>。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- FROM子句中的派生表必须指定别名。</span><br><span class="hljs-comment">-- 派生表中的SELECT语句包含聚集函数时需要为其指定别名。</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sc,(<span class="hljs-keyword">SELECT</span> sno,<span class="hljs-built_in">AVG</span>(grade) avg_grade <span class="hljs-keyword">FROM</span> sc <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> sno) <span class="hljs-keyword">as</span> savg<br><span class="hljs-keyword">WHERE</span> sc.sno <span class="hljs-operator">=</span> savg.sno <span class="hljs-keyword">AND</span> sc.grade <span class="hljs-operator">&gt;</span> savg.avg_grade;<br><br></code></pre></td></tr></table></figure><h2 id="3-4-数据更新"><a href="#3-4-数据更新" class="headerlink" title="3.4 数据更新"></a>3.4 数据更新</h2><h3 id="3-4-1-插入"><a href="#3-4-1-插入" class="headerlink" title="3.4.1 插入"></a>3.4.1 插入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 1. 插入元组 ------------------------------</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> [(<span class="hljs-operator">&lt;</span>属性列 <span class="hljs-number">1</span><span class="hljs-operator">&gt;</span> [, <span class="hljs-operator">&lt;</span>属性列 <span class="hljs-number">2</span><span class="hljs-operator">&gt;</span> ...])]<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-operator">&lt;</span>常量 <span class="hljs-number">1</span><span class="hljs-operator">&gt;</span> [, <span class="hljs-operator">&lt;</span>常量 <span class="hljs-number">2</span><span class="hljs-operator">&gt;</span>...]);<br><span class="hljs-comment">-- 不指明属性则必须每个属性按序都有；指明则则按照指明的顺序，少的空值。</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">201215128</span>,<span class="hljs-string">&#x27;陈东&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>,<span class="hljs-number">18</span>,<span class="hljs-string">&#x27;IS&#x27;</span>);<br><br><span class="hljs-comment">-- 2. 插入子查询结果 ---------------------------------</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> [(<span class="hljs-operator">&lt;</span>属性列 <span class="hljs-number">1</span><span class="hljs-operator">&gt;</span> [, <span class="hljs-operator">&lt;</span>属性列 <span class="hljs-number">2</span><span class="hljs-operator">&gt;</span> ...])]<br>子查询；<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student(sname,sage)<br><span class="hljs-keyword">SELECT</span> sname,sage <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sage<span class="hljs-operator">&gt;</span><span class="hljs-number">18</span>;<br></code></pre></td></tr></table></figure><h3 id="3-4-2-修改"><a href="#3-4-2-修改" class="headerlink" title="3.4.2 修改"></a>3.4.2 修改</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">SET</span> <span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;=</span><span class="hljs-operator">&lt;</span>表达式<span class="hljs-operator">&gt;</span>[,<span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;=</span><span class="hljs-operator">&lt;</span>表达式<span class="hljs-operator">&gt;</span>] ··· <span class="hljs-comment">-- 修改属性列为什么值</span><br>[<span class="hljs-keyword">WHERE</span> <span class="hljs-operator">&lt;</span>条件<span class="hljs-operator">&gt;</span>];  <span class="hljs-comment">-- 不加条件就全部修改</span><br><br><span class="hljs-keyword">UPDATE</span> student<br><span class="hljs-keyword">SET</span> sage<span class="hljs-operator">=</span><span class="hljs-number">22</span>    <span class="hljs-comment">-- SET sage = sage + 1  年龄全部自增1</span><br><span class="hljs-keyword">WHERE</span> sno<span class="hljs-operator">=</span><span class="hljs-number">2012158</span>;<br><br><span class="hljs-comment">-- 带子查询的修改 ------</span><br><span class="hljs-keyword">UPDATE</span> student<br><span class="hljs-keyword">SET</span> sage<span class="hljs-operator">=</span><span class="hljs-number">22</span><br><span class="hljs-keyword">WHERE</span> sno <span class="hljs-keyword">IN</span><br>	(<span class="hljs-keyword">SELECT</span> sno <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sage<span class="hljs-operator">&gt;</span><span class="hljs-number">18</span>);<br></code></pre></td></tr></table></figure><h3 id="3-4-3-删除"><a href="#3-4-3-删除" class="headerlink" title="3.4.3 删除"></a>3.4.3 删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> [<span class="hljs-keyword">WHERE</span> <span class="hljs-operator">&lt;</span>条件<span class="hljs-operator">&gt;</span>]; <span class="hljs-comment">-- 不加WHERE就全删，一条一条删</span><br><br><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sno<span class="hljs-operator">=</span><span class="hljs-number">2012145</span>;<br><span class="hljs-comment">-- 带子查询删除 -------------</span><br><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> student<br><span class="hljs-keyword">WHERE</span> sno <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span> sno <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sage<span class="hljs-operator">&gt;</span><span class="hljs-number">18</span>);<br></code></pre></td></tr></table></figure><h2 id="3-5-空值的处理"><a href="#3-5-空值的处理" class="headerlink" title="3.5 空值的处理"></a>3.5 空值的处理</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 1. 产生，使用NULL</span><br><span class="hljs-comment">-- 2. 判断，IS NULL  ,  IS NOT NULL</span><br><span class="hljs-comment">-- 3. 约束条件，创建时加上</span><br><span class="hljs-comment">-- 4. 运算</span><br>	空值与另一个（空）值的算术结果为空值，比较结果为 <span class="hljs-literal">UNKNOWN</span><br>	<span class="hljs-literal">TRUE</span>, <span class="hljs-literal">FALSE</span>, <span class="hljs-literal">UNKNOWN</span><br></code></pre></td></tr></table></figure><table><thead><tr><th align="center">x</th><th align="center">y</th><th align="center">x AND y</th><th align="center">x OR y</th></tr></thead><tbody><tr><td align="center">T</td><td align="center">T</td><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">U</td><td align="center">U</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">F</td><td align="center">F</td><td align="center">T</td></tr><tr><td align="center">U</td><td align="center">T</td><td align="center">U</td><td align="center">T</td></tr><tr><td align="center">U</td><td align="center">U</td><td align="center">U</td><td align="center">U</td></tr><tr><td align="center">U</td><td align="center">F</td><td align="center">F</td><td align="center">U</td></tr><tr><td align="center">F</td><td align="center">T</td><td align="center">F</td><td align="center">T</td></tr><tr><td align="center">F</td><td align="center">U</td><td align="center">F</td><td align="center">U</td></tr><tr><td align="center">F</td><td align="center">F</td><td align="center">F</td><td align="center">F</td></tr></tbody></table><h2 id="3-6-视图"><a href="#3-6-视图" class="headerlink" title="3.6 视图"></a>3.6 视图</h2><ul><li><strong>数据库中只存放视图的定义，不存放数据</strong>，视图是从其它<strong>1个或几个基本表导出的表，是虚表。</strong></li><li>基本表中的数据发生变化，视图中的数据也随之变化</li><li>对视图的更新操作有限制</li><li>作用：<ul><li>①视图能够简化用户从操作</li><li>②视图能够使用户以多种角度看同一数据</li><li>③视图对重构数据库提供了一定程度的逻辑独立性</li><li>④视图能够对机密文件提供安全保护</li></ul></li></ul><h3 id="3-6-1-定义和删除"><a href="#3-6-1-定义和删除" class="headerlink" title="3.6.1 定义和删除"></a>3.6.1 定义和删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 定义</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> <span class="hljs-operator">&lt;</span>视图名<span class="hljs-operator">&gt;</span>[(<span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span>[,<span class="hljs-operator">&lt;</span>列名<span class="hljs-operator">&gt;</span>]···)]<br><span class="hljs-keyword">AS</span> 子查询<br>[<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">CHECK</span> OPTION];<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> is_student<br><span class="hljs-keyword">AS</span> <span class="hljs-keyword">select</span> sno,sname,sage <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> sdept <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;IS&#x27;</span>;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> is_student <span class="hljs-comment">-- 不写属性名就是查询的属性名</span><br><span class="hljs-keyword">AS</span> <span class="hljs-keyword">select</span> sno,sname,sage <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> sdept <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;IS&#x27;</span><br><span class="hljs-keyword">WITH</span> <span class="hljs-keyword">CHECK</span> OPTION; <span class="hljs-comment">-- 保证后续对视图进行操作仍需满足子查询中的条件</span><br><br><span class="hljs-comment">-- 分组视图：带有聚集函数和 GROUP BY 子句定义的视图</span><br><br><span class="hljs-comment">-- 删除</span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> <span class="hljs-operator">&lt;</span>视图名<span class="hljs-operator">&gt;</span> [CASCADE];<br><span class="hljs-comment">-- CASCADE 如果该视图有基于其导出的视图，也会强行删除。</span><br></code></pre></td></tr></table></figure><h3 id="3-6-1-查询"><a href="#3-6-1-查询" class="headerlink" title="3.6.1 查询"></a>3.6.1 查询</h3><ul><li>视图消解：从数据字典中取出视图的定义，把定义中的子查询和用户的查询结合起来，转换为等价的对基本表的查询，然后再执行修正了的查询。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">和之前的一样<br></code></pre></td></tr></table></figure><h3 id="3-6-1-更新"><a href="#3-6-1-更新" class="headerlink" title="3.6.1 更新"></a>3.6.1 更新</h3><p>更新视图—-&gt;更新基本表</p><ul><li>不可更新的视图：例如更改平均值</li><li>不允许更新的视图<ul><li>由两个以上基本表导出的（包含嵌套查询里的表）视图</li><li>视图的字段来自字段表达式或常数，只允许DELETE</li><li>视图的字段来自聚集函数</li><li>视图定义中含有GROUP BY子句</li><li>视图定义中含有DISTINCT短语</li><li>不允许更新的视图上定义的视图</li></ul></li></ul><h3 id="3-6-1-作用"><a href="#3-6-1-作用" class="headerlink" title="3.6.1 作用"></a>3.6.1 作用</h3><ul><li>简化用户的操作</li><li>使用户能以多种角度看待同一数据</li><li>对重构数据库提供了一定程度的逻辑独立性</li><li>能够对机密数据提供安全保护</li><li>可以更清晰的表达查询</li></ul><h2 id="3-7-存储过程（类似函数FUNCTION，但是函数固定返回一个值）"><a href="#3-7-存储过程（类似函数FUNCTION，但是函数固定返回一个值）" class="headerlink" title="3.7 存储过程（类似函数FUNCTION，但是函数固定返回一个值）"></a>3.7 存储过程（类似函数FUNCTION，但是函数固定返回一个值）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">Procedure</span> GetUserAccount<br>(a <span class="hljs-type">INT</span>,b <span class="hljs-type">char</span>(<span class="hljs-number">8</span>)) <span class="hljs-comment">-- 参数</span><br><span class="hljs-keyword">as</span><br>BIGIN<br>	<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> UserAccount<br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure><h1 id="第四章-数据库安全性"><a href="#第四章-数据库安全性" class="headerlink" title="第四章 数据库安全性"></a>第四章 数据库安全性</h1><ul><li>定义：数据库的安全性是指<strong>保护数据库以防止不合法使用所造成的数据泄露、更改或破坏</strong>。</li><li>一般保护方法：<strong>设置用户标识、存取权限控制</strong>。</li><li>五级安全措施：用户标识鉴定、存取控制、视图机制、审计、数据加密。</li></ul><h2 id="4-1-用户标识鉴别"><a href="#4-1-用户标识鉴别" class="headerlink" title="4.1 用户标识鉴别"></a>4.1 用户标识鉴别</h2><ul><li>唯一用户标识：用户名，用户标识号<ul><li>静态口令鉴别</li><li>动态口令鉴别</li><li>生物特征鉴别</li><li>智能卡鉴别</li></ul></li></ul><h2 id="4-2-存取控制（授权）"><a href="#4-2-存取控制（授权）" class="headerlink" title="4.2 存取控制（授权）"></a>4.2 存取控制（授权）</h2><ul><li>定义用户权限，并将用户权限登记到数据字典中。</li><li>合法权限检查：用户发出请求，DBMS查询数据字典确认。</li><li><strong>内容</strong>：</li><li>1.要存取的数据对象</li><li>2.对此数据对象进行操作的类型</li></ul><h3 id="4-2-1-自主存取控制方法（MAC）"><a href="#4-2-1-自主存取控制方法（MAC）" class="headerlink" title="4.2.1 自主存取控制方法（MAC）"></a>4.2.1 自主存取控制方法（MAC）</h3><ul><li><p>用户对不同的数据对象有不同的存取权限</p></li><li><p>不同的用户对同一对象也有不同的权限</p></li><li><p>用户还可将其拥有的存取权限转授给其他用户</p></li><li><p>通过 GRANT 和 REVOKE 语句实现（授权）</p></li></ul><h3 id="4-2-2-授权（访问数据的权限）"><a href="#4-2-2-授权（访问数据的权限）" class="headerlink" title="4.2.2 授权（访问数据的权限）"></a>4.2.2 授权（访问数据的权限）</h3><p>1.权限授予</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GRANT</span> <span class="hljs-operator">&lt;</span>权限<span class="hljs-operator">&gt;</span>[,<span class="hljs-operator">&lt;</span>权限<span class="hljs-operator">&gt;</span>]...<br><span class="hljs-keyword">ON</span> <span class="hljs-operator">&lt;</span>对象类型<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>对象名<span class="hljs-operator">&gt;</span>[,<span class="hljs-operator">&lt;</span>对象类型<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>对象名<span class="hljs-operator">&gt;</span>]...<br><span class="hljs-keyword">TO</span> <span class="hljs-operator">&lt;</span>用户<span class="hljs-operator">&gt;</span>[,<span class="hljs-operator">&lt;</span>用户<span class="hljs-operator">&gt;</span>]...<br>[<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> OPTION]; <span class="hljs-comment">-- 指定该子句可以再转授权限，不允许循环授权即授权给祖先</span><br><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span><br><span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> student<br><span class="hljs-keyword">TO</span> U1;<br><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">UPDATE</span>(sno),<span class="hljs-keyword">SELECT</span>  <span class="hljs-comment">-- 对属性列的授权必须指明列名</span><br><span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> student<br><span class="hljs-keyword">TO</span> U1;<br></code></pre></td></tr></table></figure><p>2.权限回收</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">REVOKE</span> <span class="hljs-operator">&lt;</span>权限<span class="hljs-operator">&gt;</span>[,<span class="hljs-operator">&lt;</span>权限<span class="hljs-operator">&gt;</span>]...<br><span class="hljs-keyword">ON</span> <span class="hljs-operator">&lt;</span>对象类型<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>对象名<span class="hljs-operator">&gt;</span>[,<span class="hljs-operator">&lt;</span>对象类型<span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span>对象名<span class="hljs-operator">&gt;</span>]...<br><span class="hljs-keyword">FROM</span> <span class="hljs-operator">&lt;</span>用户<span class="hljs-operator">&gt;</span>[,<span class="hljs-operator">&lt;</span>用户<span class="hljs-operator">&gt;</span>]...<br>[RESTRICT<span class="hljs-operator">|</span>CASCADE];<br><span class="hljs-comment">-- CASCADE 级联：该用户传播出去的权限也回收。</span><br><span class="hljs-comment">-- RESTRICT 限制：如果该用户传播过权限，就拒绝这个语句的执行。</span><br><span class="hljs-comment">-- 不指明就按照缺省值，不同系统缺省值不同。</span><br><br><span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">SELECT</span><br><span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> student<br><span class="hljs-keyword">FROM</span> PUBLIC; <span class="hljs-comment">-- 所有用户权限</span><br></code></pre></td></tr></table></figure><h3 id="4-2-3-数据库角色"><a href="#4-2-3-数据库角色" class="headerlink" title="4.2.3 数据库角色"></a>4.2.3 数据库角色</h3><ul><li>角色是指一类人，比如说 CEO、总监、普通职员，可以给一类人授权</li></ul><p>1.角色创建</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> ROLE <span class="hljs-operator">&lt;</span>角色名<span class="hljs-operator">&gt;</span>;<br><br><span class="hljs-keyword">CREATE</span> ROLE CEO;<br></code></pre></td></tr></table></figure><p>2.角色授权</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GRANT</span> <span class="hljs-operator">&lt;</span>权限<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">&lt;</span>对象类型<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>对象名<span class="hljs-operator">&gt;</span>[列名]  [<span class="hljs-keyword">WHEN</span> 条件]  <span class="hljs-keyword">TO</span> <span class="hljs-operator">&lt;</span>角色<span class="hljs-operator">&gt;</span> [<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> OPTION];<br><span class="hljs-comment">-- 如果加上 WITH ADMIN OPTION，意味着，这个用户还可以吧这权限授予给其他角色或者用户。</span><br><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> Employee <span class="hljs-keyword">TO</span> CEO ; <span class="hljs-comment">-- 查询</span><br>      <span class="hljs-keyword">UPDATE</span>   <span class="hljs-comment">-- 更新</span><br>      <span class="hljs-keyword">UPDATE</span>(属性名)   <span class="hljs-comment">-- 更新某一属性</span><br>	  <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span>   <span class="hljs-comment">-- 修改表结构</span><br>      <span class="hljs-keyword">ALL</span> PRIVILIGES  <span class="hljs-comment">-- 所有权限</span><br>                                  PUBLIC <span class="hljs-comment">-- 所有人</span><br><br><span class="hljs-comment">-- 对于很复杂的，先建立视图在给予权限</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> DS(Sname,Smax,Smin,Savg)<br><span class="hljs-keyword">AS</span><br><span class="hljs-keyword">SELECT</span> DepartmentId,<span class="hljs-built_in">max</span>(Employee.Salary),<span class="hljs-built_in">min</span>(Employee.Salary),<span class="hljs-built_in">avg</span>(Employee.Salary)<br><span class="hljs-keyword">FROM</span> Employee,Department<br><span class="hljs-keyword">WHERE</span> DepartmentId<span class="hljs-operator">=</span>Department.ID<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DepartmentId;<br><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span><br><span class="hljs-keyword">ON</span> <span class="hljs-keyword">VIEW</span> DS<br><span class="hljs-keyword">TO</span> 杨兰<br></code></pre></td></tr></table></figure><p>3.把角色授权给其他用户或角色</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GRANT</span> <span class="hljs-operator">&lt;</span>角色<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">TO</span> <span class="hljs-operator">&lt;</span>其他角色或用户<span class="hljs-operator">&gt;</span> [<span class="hljs-keyword">WITH</span> ADMIN OPTION];<br><br><span class="hljs-keyword">GRANT</span> CEO <span class="hljs-keyword">TO</span> Panzhicheng <span class="hljs-keyword">WITH</span> ADMIN OPTION;<br></code></pre></td></tr></table></figure><p>4.角色权限收回</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">REVOKE</span> <span class="hljs-operator">&lt;</span>权限<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">FROM</span> <span class="hljs-operator">&lt;</span>角色<span class="hljs-operator">&gt;</span>;<br><br><span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> Employee <span class="hljs-keyword">FROM</span> CEO;<br></code></pre></td></tr></table></figure><ul><li>可能无意泄露数据</li></ul><h3 id="4-2-4-强制存取控制方法（MAC）"><a href="#4-2-4-强制存取控制方法（MAC）" class="headerlink" title="4.2.4 强制存取控制方法（MAC）"></a>4.2.4 强制存取控制方法（MAC）</h3><ul><li><strong>主体</strong>：活动实体，如用户</li><li><strong>客体</strong>：被动实体，如基本表</li><li><strong>敏感度标记</strong>：绝密TS &gt;&#x3D; 机密S &gt;&#x3D; 可信C &gt;&#x3D; 公开P<ul><li>为每个主体与客体指派一个敏感度标记</li></ul></li><li><strong>规则</strong>：<ul><li>仅当主体的许可证级别<strong>大于或等于</strong>客体的密级时，该主体才能<strong>读取</strong>相应的客体。</li><li>仅当主体的许可证级别<strong>小于或等于</strong>客体的密级时，该主体才能<strong>写</strong>相应的客体。</li></ul></li><li>标记与数据是不可分的整体，复制仍然在。</li></ul><h3 id="4-2-3-总结"><a href="#4-2-3-总结" class="headerlink" title="4.2.3 总结"></a>4.2.3 总结</h3><ul><li>先DAC检查再MAC检查，</li><li>自主存取控制方法（DAC）与强制存取控制方法（MAC）共同构成数据库管理系统的安全机制。</li></ul><h2 id="4-3-视图机制"><a href="#4-3-视图机制" class="headerlink" title="4.3 视图机制"></a>4.3 视图机制</h2><ul><li>为不同的用户定义不同的视图，把不需要的数据给隐藏起来，这样用户就不会误操作。<ul><li>服务器事件</li><li>系统权限</li><li>语句事件</li><li>模式对象事件</li></ul></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 1. 创建视图</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> CS_Student<br><span class="hljs-keyword">AS</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> Student<br><span class="hljs-keyword">WHERE</span> Sdept <span class="hljs-operator">=</span> ‘<span class="hljs-keyword">IS</span>’;<br><br><span class="hljs-comment">-- 2. 授权角色</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> CS_Student <span class="hljs-keyword">TO</span> Panzhicheng;<br><span class="hljs-keyword">GRANT</span> ALL_PRIVILEGES <span class="hljs-keyword">ON</span> CS_Student <span class="hljs-keyword">TO</span> Panzhicheng;<br></code></pre></td></tr></table></figure><h2 id="4-4-审计（事后监控措施）"><a href="#4-4-审计（事后监控措施）" class="headerlink" title="4.4 审计（事后监控措施）"></a>4.4 审计（事后监控措施）</h2><ul><li>任何操作都记录到审计日志，然后看日志，里面是否有非法行为。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 对修改 SC 数据的操作进行审计（AUDIT）</span><br>AUDIT <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> SC;<br><br><span class="hljs-comment">-- 取消对 SC 表的一切审计（NOAUDIT）</span><br>NOAUDIT <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> SC;<br></code></pre></td></tr></table></figure><h2 id="4-5-数据加密"><a href="#4-5-数据加密" class="headerlink" title="4.5 数据加密"></a>4.5 数据加密</h2><ul><li>通过一些加密算法，把明文变成密文，这样别人就无法查看。<ul><li>存储加密</li><li>传输加密<ul><li>链路加密</li><li>端到端加密</li></ul></li></ul></li></ul><h2 id="4-5-其它安全性保护"><a href="#4-5-其它安全性保护" class="headerlink" title="4.5 其它安全性保护"></a>4.5 其它安全性保护</h2><ul><li>推理控制：避免用户利用其能够访问的数据推知更高密级的数据</li><li>隐蔽信道</li><li>数据隐私保护：控制个人数据</li></ul><h1 id="第五章-数据库完整性"><a href="#第五章-数据库完整性" class="headerlink" title="第五章 数据库完整性"></a>第五章 数据库完整性</h1><ul><li><strong>主要任务</strong>：保障数据的正确性、有效性、协调性，提高数据对用户的可用性。</li><li><strong>值</strong>的约束和<strong>结构</strong>的约束</li><li><strong>措施</strong>：<ul><li>适时检查完整性约束条件，保证语义完整。</li><li>控制并发操作，使其不破坏完整性。</li><li>在系统发生故障后，即时恢复系统。</li></ul></li></ul><h2 id="5-1-完整性定义"><a href="#5-1-完整性定义" class="headerlink" title="5.1 完整性定义"></a>5.1 完整性定义</h2><ul><li><p><strong>正确性</strong>：符合现实世界的描述（<strong>正确性、相容性</strong>）</p></li><li><p><strong>相容性</strong>：同一个对象在不同表里面是符合逻辑，比如我的地址、年龄，在不同的表里应该一致</p></li><li><p>维护数据库完整性（措施）：</p><ul><li>提供完整性约束条件的机制</li><li>提供完整性检查的方法</li><li>进行违约处理</li></ul></li></ul><h2 id="5-2-实体完整性"><a href="#5-2-实体完整性" class="headerlink" title="5.2 实体完整性"></a>5.2 实体完整性</h2><ul><li><strong>主码值唯一，且非空</strong>。<ul><li>主键一般自带索引，查找速度极快。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Course (id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>                    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>));<br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="5-3-参照完整性"><a href="#5-3-参照完整性" class="headerlink" title="5.3 参照完整性"></a>5.3 参照完整性</h2><ul><li><strong>外码可以是空值或另一个关系主码的有效值</strong>。</li><li>对参照表和被参照表增删改操作时有可能破坏参照完整性，必须进行检查。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Course (id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>                    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>),<br>                    teacher_id <span class="hljs-type">INT</span>,<br>                    <span class="hljs-keyword">PRIMARY</span> KEY(id),<br>                    <span class="hljs-keyword">FOREIGN</span> KEY(ID) <span class="hljs-keyword">REFERENCES</span> Course_description(Course_id));<br><span class="hljs-comment">-- FOREIGN 定义外码</span><br><span class="hljs-comment">-- REFERENCES 指明外码参照哪些表的主码</span><br></code></pre></td></tr></table></figure><h2 id="5-4-用户定义的完整性"><a href="#5-4-用户定义的完整性" class="headerlink" title="5.4 用户定义的完整性"></a>5.4 用户定义的完整性</h2><ul><li><p>非空 NOT NULL</p></li><li><p>列值唯一 UNIQUE</p></li><li><p>属性满足某一个条件表达式 CHECK</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> SC (Sno <span class="hljs-type">CHAR</span>(<span class="hljs-number">9</span>) <span class="hljs-keyword">PRIMARY</span> KEY,<br>                   Sname <span class="hljs-type">CHAR</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>                   Ssex <span class="hljs-type">CHAR</span>(<span class="hljs-number">2</span>) <span class="hljs-keyword">CHECK</span> (Ssex <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>))<br>                   Grade <span class="hljs-type">SMALLINT</span> <span class="hljs-keyword">CHECK</span> (Grade<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span>);<br></code></pre></td></tr></table></figure></li><li><p>元组满足某一个条件表达式 CHECK</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> SC (Sno <span class="hljs-type">CHAR</span>(<span class="hljs-number">9</span>) <span class="hljs-keyword">PRIMARY</span> KEY,<br>                   Sname <span class="hljs-type">CHAR</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>                   Ssex <span class="hljs-type">CHAR</span>(<span class="hljs-number">2</span>)<br>                   Grade <span class="hljs-type">SMALLINT</span><br>                   <span class="hljs-keyword">CHECK</span> (Ssex<span class="hljs-operator">=</span><span class="hljs-string">&#x27;女&#x27;</span> <span class="hljs-keyword">OR</span> Sname <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;Ms.%&#x27;</span>);<br></code></pre></td></tr></table></figure></li><li><p>属性上的约束条件检查和违约处理</p></li><li><p>元组上的约束条件检查和违约处理</p></li></ul><h2 id="5-5-断言"><a href="#5-5-断言" class="headerlink" title="5.5 断言"></a>5.5 断言</h2><ul><li>通过声明性断言来指定更具一般性的约束。</li><li>可以定义涉及多个表或聚集操作的比较复杂的完整性约束。</li><li>断言创建以后，任何对断言中所涉及关系的操作都会触发关系数据库管理系统对断言的检查，任何使断言不为真值的操作都会被拒绝执行。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建断言</span><br><span class="hljs-keyword">CREATE</span> ASSERTION <span class="hljs-operator">&lt;</span>断言名<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">CHECK</span>子句<span class="hljs-operator">&gt;</span>;<br><br><span class="hljs-keyword">CREATE</span> ASSERTION ASSE_SC_CNUM1<br>	<span class="hljs-keyword">CHECK</span>(<span class="hljs-number">60</span><span class="hljs-operator">&gt;=</span><span class="hljs-keyword">ALL</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<br>    			  <span class="hljs-keyword">FROM</span> SC<br>                  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> cno)<br>    );<br><br><span class="hljs-comment">-- 删除断言</span><br><span class="hljs-keyword">DROP</span> ASSERTION <span class="hljs-operator">&lt;</span>断言名<span class="hljs-operator">&gt;</span>;<br></code></pre></td></tr></table></figure><h2 id="5-6-触发器"><a href="#5-6-触发器" class="headerlink" title="5.6 触发器"></a>5.6 触发器</h2><ul><li>触发器也叫做 事件 -&gt; 条件 -&gt; 动作 规则。</li><li>当对一个表增删改的时候，对触发器里面的条件进行检查，如果成立就会执行触发器里的动作，否则不执行里面的动作。</li></ul><h3 id="5-6-1-定义触发器"><a href="#5-6-1-定义触发器" class="headerlink" title="5.6.1 定义触发器"></a>5.6.1 定义触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> <span class="hljs-operator">&lt;</span>触发器名<span class="hljs-operator">&gt;</span>  <span class="hljs-comment">-- 同一模式下唯一</span><br>&#123;BEFORE<span class="hljs-operator">|</span>AFTER&#125; <span class="hljs-operator">&lt;</span>触发事件<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span>  <span class="hljs-comment">-- 只能定义在基本表上，触发器名和表名必须在同一模式下</span><br><br><span class="hljs-keyword">REFERENCING</span> <span class="hljs-keyword">NEW</span><span class="hljs-operator">|</span><span class="hljs-keyword">OLD</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">AS</span> <span class="hljs-operator">&lt;</span>变量<span class="hljs-operator">&gt;</span>  <span class="hljs-comment">-- 只在行级触发器中有用</span><br><span class="hljs-keyword">REFERENCING</span> <span class="hljs-keyword">NEW</span><span class="hljs-operator">|</span><span class="hljs-keyword">OLD</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">AS</span> <span class="hljs-operator">&lt;</span>变量<span class="hljs-operator">&gt;</span>  <span class="hljs-comment">-- 只在语句级触发器中有用</span><br><br><span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> &#123;<span class="hljs-type">ROW</span><span class="hljs-operator">|</span>STATEMENT&#125;  <span class="hljs-comment">-- 行级触发器/语句级触发器</span><br><br>[<span class="hljs-keyword">WHEN</span>（触发条件）]<br>或<br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-operator">&lt;</span>触发动作体<span class="hljs-operator">&gt;</span> <span class="hljs-comment">-- 注意缩进</span><br><span class="hljs-keyword">END</span>；<br></code></pre></td></tr></table></figure><h3 id="5-6-2-激活触发器"><a href="#5-6-2-激活触发器" class="headerlink" title="5.6.2 激活触发器"></a>5.6.2 激活触发器</h3><ul><li><strong>数据操纵会自动执行触发器所定义的SQL语句</strong>。</li><li>由触发事件激活，并由数据库服务器自动执行</li><li>执行顺序：<ul><li>1.执行BEFORE触发器</li><li>2.执行触发器的SQL语句</li><li>3.执行AFTER触发器</li></ul></li></ul><h3 id="5-6-3-删除触发器"><a href="#5-6-3-删除触发器" class="headerlink" title="5.6.3 删除触发器"></a>5.6.3 删除触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TRIGGER</span> <span class="hljs-operator">&lt;</span>触发器名<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">&lt;</span>表名<span class="hljs-operator">&gt;</span>;<br></code></pre></td></tr></table></figure><h1 id="第六章-关系数据理论"><a href="#第六章-关系数据理论" class="headerlink" title="第六章 关系数据理论"></a>第六章 关系数据理论</h1><h2 id="6-1-问题的提出"><a href="#6-1-问题的提出" class="headerlink" title="6.1 问题的提出"></a>6.1 问题的提出</h2><ul><li>第一范式（1NF）：每个分量是不可分的数据项。</li><li>数据依赖（难）：<ul><li>是一个关系内部属性与属性之间的约束关系</li><li>是现实世界属性间相互联系的抽象</li><li>是数据内在的性质</li><li>是语义的体现<ul><li>函数依赖：一 一对应</li><li>多值依赖</li></ul></li></ul></li></ul><p>举个例子：（学号，所在系，系主任，课程号，成绩）</p><ul><li>学号 –&gt; 所在系</li><li>所在系 –&gt; 系主任</li><li>学号+课程号 –&gt; 成绩<br>存在多个依赖，数据有很大的冗余<br>（学号，所在系）<br>（学号，课程号，成绩）<br>（所在系，系主任）</li></ul><h2 id="6-2-规范化"><a href="#6-2-规范化" class="headerlink" title="6.2 规范化"></a>6.2 规范化</h2><ul><li><p><strong>函数依赖</strong>：（多对一映射）所有元组中都满足的，例如，学号 –&gt; 所在系。</p><ul><li>Y函数依赖于X</li><li>平凡函数依赖：X –&gt; Y, Y属于X（废话，自己决定自己）</li><li>不平凡函数依赖：X –&gt; Y, Y不属于X（这才是我们讨论的）</li></ul></li><li><p>若 X –&gt; Y，则称X为这个函数依赖的决定因素</p></li><li><p>若 X –&gt; Y，Y –&gt; X，则记作 X &lt;–&gt; Y</p></li><li><p><strong>完全函数依赖</strong>：X —-F—-&gt; Y，当 X –&gt; Y，且对任意的X真子集XX（多个主属性中的几个），都没有 XX –&gt; Y。</p></li><li><p><strong>部分函数依赖</strong>：X —-P—-&gt; Y， 完全依赖+其它属性&#x3D;部分依赖（只依赖主码中的部分属性）</p></li><li><p><strong>传递函数依赖</strong>：X –&gt; Y，Y –&gt; Z，则 Z 传递依赖于 X 。（默认非平凡，不能主属性之间互推）</p></li><li><p>超码（见2.1.1）：候选码+其它属性</p></li><li><p><strong>闭包</strong>就是通过这些属性能够直接推出或间接推出的属性集的集合。</p></li><li><p><strong>无损连接性</strong>：如果R1∩R2是R1或R2的超码，则R上的分解（R1，R2）是无损分解。</p></li><li><p><strong>保持函数依赖性</strong>：F上的每一个函数依赖都在其分解后的某一个关系上成立（充分条件），则原关系必满足3NF。</p></li></ul><h2 id="6-3-范式"><a href="#6-3-范式" class="headerlink" title="6.3 范式"></a>6.3 范式</h2><ul><li>符合某一种级别的关系模式的集合。</li><li>1NF 包含于 2NF 包含于 3NF 包含于 BCNF 包含于 4NF 包含于 5NF</li><li><strong>规范化</strong>：一个低一级范式的关系模式，通过<strong>模式分解</strong>，转化为若干个高一级范式的关系模式的集合。</li></ul><h3 id="6-3-1-第一范式（1NF）"><a href="#6-3-1-第一范式（1NF）" class="headerlink" title="6.3.1 第一范式（1NF）"></a>6.3.1 第一范式（1NF）</h3><ul><li>每个分量是不可分的数据项。</li><li>问题：数据冗余度大，插入异常，删除异常，修改异常</li></ul><h3 id="6-3-2-第二范式（2NF）"><a href="#6-3-2-第二范式（2NF）" class="headerlink" title="6.3.2 第二范式（2NF）"></a>6.3.2 第二范式（2NF）</h3><ul><li>在满足1NF的基础上，且非主属性<strong>完全依赖于</strong>主码。</li></ul><h3 id="6-3-3-第三范式（3NF）"><a href="#6-3-3-第三范式（3NF）" class="headerlink" title="6.3.3 第三范式（3NF）"></a>6.3.3 第三范式（3NF）</h3><ul><li>在满足2NF的基础上，且每个非主属性都<strong>不传递函数依赖于</strong>主码。</li></ul><h3 id="6-3-4-BCNF（修正的-3NF）"><a href="#6-3-4-BCNF（修正的-3NF）" class="headerlink" title="6.3.4 BCNF（修正的 3NF）"></a>6.3.4 BCNF（修正的 3NF）</h3><ul><li>消除每一个<strong>主属性</strong>对<strong>候选码</strong>的<strong>部分或传递</strong>依赖（主属性很多，候选码内部传递依赖）。</li><li>满足BCNF，则实现了模式的彻底分解，<strong>消除了插入异常（该插没插）和删除异常（不该删被删）</strong>。</li></ul><h3 id="6-3-5-多值依赖（一对几个多，多中的相互独立，可独立变化）"><a href="#6-3-5-多值依赖（一对几个多，多中的相互独立，可独立变化）" class="headerlink" title="6.3.5 多值依赖（一对几个多，多中的相互独立，可独立变化）"></a>6.3.5 多值依赖（一对几个多，多中的相互独立，可独立变化）</h3><ul><li>对于R(U),X,Y,Z是U的子集，并且X+Y+Z&#x3D;U。<strong>U的任何子集及其组合都不重复</strong>。X，Y，Z互相多值依赖。</li><li>X –&gt;–&gt; Y</li><li>对称性</li><li>传递性</li></ul><h3 id="6-3-6-第四范式（4NF）"><a href="#6-3-6-第四范式（4NF）" class="headerlink" title="6.3.6 第四范式（4NF）"></a>6.3.6 第四范式（4NF）</h3><ul><li>在满足BCNF的基础上，属性之间不允许有非平凡且非函数依赖的多值依赖，只允许函数依赖。</li><li><strong>二目关系都属于4NF</strong></li></ul><h2 id="6-4-数据依赖的公理系统"><a href="#6-4-数据依赖的公理系统" class="headerlink" title="6.4 数据依赖的公理系统"></a>6.4 数据依赖的公理系统</h2><ul><li>模式分解算法的理论基础。</li><li>Armstrong公理系统：函数依赖的一个有效而完备的公理系统。</li></ul><p><img src="/images/loading.png" srcset="/img/loading.gif" lazyload data-original="/2025/01/11/%E6%95%B0%E6%8D%AE%E5%BA%93/armstrong.png"></p><h2 id="6-5-模式分解（规范化）"><a href="#6-5-模式分解（规范化）" class="headerlink" title="6.5 模式分解（规范化）"></a>6.5 模式分解（规范化）</h2><p>找主码，（检查完全依赖、检查传递依赖）–找所有函数依赖</p><ol><li>1NF到2NF：拆主码，其中一个主码不变。</li><li>2NF到3NF：传递拆开，X-&gt;Y-&gt;Z，拆成X,Y ; Y,Z。</li><li>3NF到BCNF：拆主属性</li></ol><h2 id="6-6-解题"><a href="#6-6-解题" class="headerlink" title="6.6 解题"></a>6.6 解题</h2><ul><li>求<strong>闭包</strong>：必包含自身。</li><li>求<strong>候选码</strong>：<ul><li>①只在F右部出现的属性，不属于候选码</li><li>②只在F左部出现的属性，一定存在于某候选码当中</li><li>③两边都没有出现的属性，一定存在于候选码中</li><li>④其他属性逐个与②③的属性结合，求属性闭包 ，直至X的闭包等于U。若等于U，则X为候选码</li></ul></li><li>求<strong>极小函数依赖集</strong>：<ul><li>①单一化，右边只有一个属性</li><li>②去掉左边多余属性</li><li>③去掉多余依赖</li></ul></li></ul><h1 id="第七章-数据库设计"><a href="#第七章-数据库设计" class="headerlink" title="第七章 数据库设计"></a>第七章 数据库设计</h1><h2 id="7-1-数据库设计概念"><a href="#7-1-数据库设计概念" class="headerlink" title="7.1 数据库设计概念"></a>7.1 数据库设计概念</h2><ul><li>基本步骤：<br>1.需求分析<br>2.概念结构设计：E-R图或者设计数据字典<br>3.逻辑结构设计：E-R图 -&gt; 逻辑模型<br>4.物理结构设计：逻辑模型 -&gt; 物理模型<br>5.数据库实施：写SQL代码<br>6.数据库运维：性能检测</li></ul><h2 id="7-2-需求分析"><a href="#7-2-需求分析" class="headerlink" title="7.2 需求分析"></a>7.2 需求分析</h2><ul><li>产生数据字典，是全系统中数据项、数据结构、数据流、数据存储的描述。</li><li>工具：数据流程图、数据字典</li></ul><h2 id="7-3-概念结构设计"><a href="#7-3-概念结构设计" class="headerlink" title="7.3 概念结构设计"></a>7.3 概念结构设计</h2><h3 id="7-3-1-E-R图"><a href="#7-3-1-E-R图" class="headerlink" title="7.3.1 E-R图"></a>7.3.1 E-R图</h3><ul><li><p>实体间的联系</p><ul><li>一对一联系（1:1）</li><li>一对多联系（1:n）</li><li>多对多联系（m:n）</li></ul></li><li><p>二元联系：两个实体型之间的联系，度为2。</p></li><li><p>三元联系：三个实体型之间的联系，度为3。</p></li><li><p>N元联系：N个实体型之间的联系，度为N。</p></li><li><p>实体：矩形</p></li><li><p>属性：椭圆形</p></li><li><p>联系：菱形</p></li></ul><h3 id="7-3-2-合并E-R图"><a href="#7-3-2-合并E-R图" class="headerlink" title="7.3.2 合并E-R图"></a>7.3.2 合并E-R图</h3><p>1.<strong>属性冲突</strong></p><ul><li>属性域</li><li>属性单位</li></ul><p>2.<strong>命名冲突</strong></p><ul><li>同名异义</li><li>异名同义</li></ul><p>3.<strong>结构冲突</strong></p><ul><li>又当实体又当属性</li><li>同一实体的属性个数与属性排列次序不完全相同</li><li>实体间的联系在不同E-R图中为不同类型</li></ul><h2 id="7-4-逻辑结构设计"><a href="#7-4-逻辑结构设计" class="headerlink" title="7.4 逻辑结构设计"></a>7.4 逻辑结构设计</h2><p>1.一个<strong>实体型</strong>转换为一个关系模式</p><ul><li>关系的属性：实体的属性</li><li>关系的码：实体的码</li></ul><p>2.一个<strong>1:m</strong>联系，在 M 端添加另一端的主键。<br>3.一个<strong>m:n</strong>联系，将联系转换为实体，然后在该实体上加上另外两个实体的主键。<br>4.一个多元联系转换，和二元类似。<br>5.具有相同码的关系模式可合并。</p><h2 id="7-5-物理结构设计"><a href="#7-5-物理结构设计" class="headerlink" title="7.5 物理结构设计"></a>7.5 物理结构设计</h2><ul><li>B+树索引</li><li>hash索引</li><li>聚簇方法（在物理上连续，同一页）</li></ul><h2 id="7-6-数据库的实施与维护"><a href="#7-6-数据库的实施与维护" class="headerlink" title="7.6 数据库的实施与维护"></a>7.6 数据库的实施与维护</h2><h3 id="7-6-1-数据的载入和应用程序的调试"><a href="#7-6-1-数据的载入和应用程序的调试" class="headerlink" title="7.6.1 数据的载入和应用程序的调试"></a>7.6.1 数据的载入和应用程序的调试</h3><ul><li>数据库应用程序的设计应该与数据库设计同时进行。</li></ul><h3 id="7-6-2-数据库的试运行"><a href="#7-6-2-数据库的试运行" class="headerlink" title="7.6.2 数据库的试运行"></a>7.6.2 数据库的试运行</h3><ul><li>先输入小批量数据做调式用，运行合格再逐步增加数据量。</li><li>要做好数据库的转储和恢复工作。</li></ul><h3 id="7-6-3-数据库的运行和维护"><a href="#7-6-3-数据库的运行和维护" class="headerlink" title="7.6.3 数据库的运行和维护"></a>7.6.3 数据库的运行和维护</h3><h1 id="第八章-事务"><a href="#第八章-事务" class="headerlink" title="第八章 事务"></a>第八章 事务</h1><h2 id="8-1-事务的概念"><a href="#8-1-事务的概念" class="headerlink" title="8.1 事务的概念"></a>8.1 事务的概念</h2><ul><li>用户定义的一个数据库操作序列，具有原子性。类比原语。</li><li>是恢复和并发控制的基本单位。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span> TRANSACTION<br>		<span class="hljs-keyword">SQL</span> 语句<span class="hljs-number">1</span><br>        <span class="hljs-keyword">SQL</span> 语句<span class="hljs-number">2</span><br>        ......<br>[<span class="hljs-keyword">COMMIT</span><span class="hljs-operator">|</span><span class="hljs-keyword">ROLLBACK</span>]；<br><span class="hljs-comment">-- COMMIT：提交，提交事务的所有操作。（默认）</span><br><span class="hljs-comment">-- ROLLBACK：回滚，系统将事务中对数据库的所有已完成操作撤销，回滚到事务开始时的状态。</span><br></code></pre></td></tr></table></figure><h2 id="8-2-事务的特性（ACID）"><a href="#8-2-事务的特性（ACID）" class="headerlink" title="8.2 事务的特性（ACID）"></a>8.2 事务的特性（ACID）</h2><ul><li><strong>原子性Atomicity</strong>：所有操作要么都做要么都不做。</li><li><strong>一致性Consistency</strong>：事务执行结果必须使数据库从一个一致状态变到另一个一致性状态。</li><li><strong>隔离性Isolation</strong>：并发执行的各个事务之间不能互相干扰。</li><li><strong>持续性Durability</strong>：一个事务一旦提交，它对数据库的改变是永久的。</li></ul><h2 id="8-3-事务的故障"><a href="#8-3-事务的故障" class="headerlink" title="8.3 事务的故障"></a>8.3 事务的故障</h2><ol><li><p><strong>事务（内部）故障</strong>：事务未完成，强行回滚。rollback；</p></li><li><p><strong>系统故障</strong>：造成系统停转的任何事件。</p></li><li><p><strong>介质故障</strong>：硬件损坏</p></li><li><p><strong>计算机病毒</strong></p></li></ol><h2 id="8-4-数据库恢复—利用冗余数据"><a href="#8-4-数据库恢复—利用冗余数据" class="headerlink" title="8.4 数据库恢复—利用冗余数据"></a>8.4 数据库恢复—利用冗余数据</h2><ul><li><p>将数据库从错误状态恢复到某一已知的正确状态</p></li><li><p>技术：</p><ul><li>数据转储（静态与动态）</li><li>登记日志文件<ul><li>登记的次序严格按并发事务执行的顺序</li><li>必须先写日志文件，后写数据库</li></ul></li></ul></li><li><p>策略：</p><ul><li><strong>事务故障</strong>：反向扫描日志文件，查找该事务的更新操作，依次进行逆操作。</li><li><strong>系统故障</strong>：正向扫描日志文件，故障前发生的事务加入重做队列，故障时未发生的事务加入撤销队列，对重做队列中的事务进行重做处理，对撤销队列中的事务进行撤销（UNDO）处理。</li><li><strong>介质故障</strong>：重装数据库，然后重做已完成的事务。</li></ul></li></ul><h3 id="8-4-1-后援副本"><a href="#8-4-1-后援副本" class="headerlink" title="8.4.1 后援副本"></a>8.4.1 后援副本</h3><h3 id="8-4-2-日志文件"><a href="#8-4-2-日志文件" class="headerlink" title="8.4.2 日志文件"></a>8.4.2 日志文件</h3><p>日志文件是用来记录事务对数据库更新操作的文件。日志文件主要有以下两种格式：</p><ul><li>以<strong>记录</strong>为单位的日志文件包括：<ul><li>各个事务开始的标记；</li><li>各个事务的结束标记；</li><li>各个事务的所有更新操作。</li><li>每个事务的开始标记、结束标记和每个更新操作构成一个日志记录。</li></ul></li><li>以<strong>数据块</strong>为单位的日志文件包括：<ul><li>事务标识（标明是哪个事务）</li><li>操作的类型（插入、删除或修改）</li><li>操作对象（记录内部标识）</li><li>更新前数据的旧值（对插入操作而言此项为空值）</li><li>更新后数据的新值（对删除操作而言此项为空值）</li></ul></li></ul><p>作用：<br>（1）事务故障恢复和系统故障恢复必须用日志文件；<br>（2）在动态转储方式中必须建立日志文件，后备副本和日志文件结合起来才能有效地恢复数据库；<br>（3）在静态转储方式中也可以建立日志文件。</p><p>登记原则：<br>（1）登记的次序严格按照并发事务执行的时间次序。<br>（2）必须先写日志文件，后写数据库。</p><h1 id="第九章-并发控制"><a href="#第九章-并发控制" class="headerlink" title="第九章 并发控制"></a>第九章 并发控制</h1><ul><li><strong>事务是并发控制的基本单位</strong>，保证事务ACID特性是事务处理的重要任务。</li><li>事务的ACID可能遭到破坏的原因是多个事务对数据库的并发操作造成的。</li><li>为了保证事务的<strong>隔离性和一致性</strong>，DBMS需要读并发操作进行正确调度。</li></ul><h2 id="9-1-并发带来的问题（数据不一致）"><a href="#9-1-并发带来的问题（数据不一致）" class="headerlink" title="9.1 并发带来的问题（数据不一致）"></a>9.1 并发带来的问题（数据不一致）</h2><ul><li><p><strong>丢失修改</strong></p></li><li><p><strong>脏读</strong></p></li><li><p><strong>不可重复读</strong>：读后被修改，无法再次重现读</p></li><li><p>原因：并发操作破坏了事务的隔离性。</p></li></ul><h2 id="9-2-方法：封锁以及封锁协议"><a href="#9-2-方法：封锁以及封锁协议" class="headerlink" title="9.2 方法：封锁以及封锁协议"></a>9.2 方法：封锁以及封锁协议</h2><h3 id="9-2-1-封锁（实现并发控制）"><a href="#9-2-1-封锁（实现并发控制）" class="headerlink" title="9.2.1 封锁（实现并发控制）"></a>9.2.1 封锁（实现并发控制）</h3><p>基本的锁有两类：</p><ul><li><strong>排他锁（X锁）</strong>，写锁：只允许加锁事务进行读写。</li><li><strong>共享锁（S锁）</strong>，读锁：只允许加锁事务进行读，其它事务加读锁。</li></ul><h3 id="9-2-2-封锁协议"><a href="#9-2-2-封锁协议" class="headerlink" title="9.2.2 封锁协议"></a>9.2.2 封锁协议</h3><ul><li>一级封锁协议：<strong>修改前</strong>必须加X锁，直到<strong>事务结束才释放</strong>。<ul><li>防止丢失修改</li></ul></li><li>二级封锁协议：在一级封锁协议上，<strong>读取前</strong>必须加S锁，<strong>读完后</strong>即可释放。<ul><li>防止丢失修改，防止脏读</li></ul></li><li>三级封锁协议：在一级封锁协议上，<strong>读取前</strong>必须加S锁，<strong>直到事务结束</strong>才释放。<ul><li>防止丢失修改，防止脏读，防止不可重复读</li></ul></li><li>两段封锁协议：加锁统一加，然后统一解锁。</li></ul><h2 id="9-3-活锁与死锁"><a href="#9-3-活锁与死锁" class="headerlink" title="9.3 活锁与死锁"></a>9.3 活锁与死锁</h2><h3 id="9-3-1-活锁"><a href="#9-3-1-活锁" class="headerlink" title="9.3.1 活锁"></a>9.3.1 活锁</h3><p>事务串行等待，有可能永远等待。</p><ul><li>避免活锁：采用<strong>FCFS先来先服务</strong>。</li></ul><h3 id="9-3-2-死锁"><a href="#9-3-2-死锁" class="headerlink" title="9.3.2 死锁"></a>9.3.2 死锁</h3><p>多个事务互相等待，永远不能结束。</p><ul><li>预防死锁<ul><li>一次封锁法</li><li>顺序封锁法</li></ul></li><li>诊断与解除死锁<ul><li>超时法</li><li>等待图法</li></ul></li></ul></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E8%80%83%E7%A0%94/" class="category-chain-item">考研</a></span></span></div></div><div class="license-box my-3"><div class="license-title"><div>数据库系统概论笔记</div><div>https://jimes.cn/2025/01/11/数据库/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Jimes</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2025年1月11日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-nc"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - 相同方式共享"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2025/01/19/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%EF%BC%88%E5%B8%A6%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F%EF%BC%89/" title="神经网络基础（带数学公式、代码）"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">神经网络基础（带数学公式、代码）</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2024/10/01/PDF_math/" title="23年数学建模国赛B题省二奖"><span class="hidden-mobile">23年数学建模国赛B题省二奖</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><script type="text/javascript">Fluid.utils.loadComments("#comments",function(){var t="github-light",e="github-dark",s="dark"===(s=document.documentElement.getAttribute("data-user-color-scheme"))?e:t,t=(window.UtterancesThemeLight=t,window.UtterancesThemeDark=e,document.createElement("script"));t.setAttribute("src","https://utteranc.es/client.js"),t.setAttribute("repo","jiems3/utterances_comments"),t.setAttribute("issue-term","pathname"),t.setAttribute("label","utterances"),t.setAttribute("theme",s),t.setAttribute("crossorigin","anonymous"),document.getElementById("comments").appendChild(t)})</script><script src="https://utteranc.es/client.js" repo="jimes3/utterances_comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div><span id="timeDate">正在载入天数...</span> <span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("01/01/2024 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="🚀已持续航行&nbsp"+dnum+"&nbsp天",document.getElementById("times").innerHTML=hnum+"&nbsp时&nbsp"+mnum+"&nbsp分&nbsp"+snum+"&nbsp秒"}setInterval("createtime()",250)</script></div><div class="total-wordcount">总字数: <span>62.3k</span> 字</div><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Jimes</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Blog</span></a></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script>window.MathJax?(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset(),MathJax.typesetPromise()):window.MathJax={tex:{inlineMath:{"[+]":[["$","$"]]}},loader:{load:["ui/lazy"]},options:{renderActions:{insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(t=>{t=t.parentNode;"li"===t.nodeName.toLowerCase()&&t.parentNode.classList.add("has-jax")})},"",!1]}}},Fluid.events.registerRefreshCallback(function(){"MathJax"in window&&MathJax.startup.document&&"function"==typeof MathJax.startup.document.state&&(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset(),MathJax.typesetPromise())})</script><script src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js"></script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body></html>